#!/bin/sh


stretch_notification () {
  while true; do
    osascript -e 'display notification "Stretch!" with title "syncer"';
    sleep 600;
    osascript -e 'display notification "Stretch!" with title "syncer"';
    sleep 600;
    osascript -e 'display notification "Stretch!" with title "syncer"';
    sleep 600;
    osascript -e 'display notification "Move around a bit!" with title "syncer"';
    sleep 600;
  done
}

fetch_email () {
  while true; do
    # Purge everything in trash from other tags
    [ "$USER_HOME_EMAIL" ] && notmuch-home new
    [ "$USER_WORK_EMAIL" ] && notmuch-work new

    # Apply auto-tagging script
    which autotag >/dev/null 2>&1 && autotag

    # Do gmailieer sync (for notmuch/neomutt)
    [ "$USER_HOME_EMAIL" ] && (rm ~/.notmuch-config \
                              ; ln -sf ~/.notmuch-config-home ~/.notmuch-config \
                              ; cd ~/email/home && gmi sync)
    [ "$USER_WORK_EMAIL" ] && (rm ~/.notmuch-config \
                              ; ln -sf ~/.notmuch-config-work ~/.notmuch-config \
                              ; cd ~/email/work && gmi sync)
    # Get amount of new email
    notmuch tag -unnotified tag:github or tag:trello
    new_mail=`notmuch search tag:unnotified | wc -l | awk '{print $1}'`
    # if [ $new_mail != '0' ]; then
    #   [ $OPERATING_SYSTEM = 'osx' ] && \
    #     osascript -e 'display notification "'"$new_messages"'new messages" with title "notmuch"'
    # fi
    notmuch tag -unnotified tag:unnotified
    sleep $EMAIL_SYNC_INTERVAL;
  done
}

#fetch_email & stretch_notification
fetch_email
