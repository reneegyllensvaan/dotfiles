#!/bin/sh
function join {
  delim="$1";
  shift
  while [ "$1" ]; do
    printf "$1"
    shift
    [ "$1" ] && printf ","
  done
}
cmd=$1
shift
if [ "$1" ]; then
  echo "$cmd:`join , "$@"`"
  command="$cmd:`join , "$@"`"
else
  echo $cmd
  command=$cmd
fi

BACKEND_TRIGGERS=(
  'command:api'
  'db_(restore\|upgrade\|revision\|downgrade)'
)
FRONTEND_TRIGGERS=(
  'watcher:'
)
for t in $BACKEND_TRIGGERS; do
  [ `echo $command | grep "$t"` ] && cd ~/Projects/backend/repo
done
for t in $FRONTEND_TRIGGERS; do
  [ `echo $command | grep "$t"` ] && cd ~/Projects/frontend/repo
done

fab $command
