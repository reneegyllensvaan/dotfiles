#!/bin/sh
mkdir -p ~/.config/

safe_copy () {
  which shasum >/dev/null && hash_command='shasum'
  hash_new=`$hash_command $1 | head -c 40` 
  hash_old=`$hash_command $2 | head -c 40` 
  if [[ $hash_new = $hash_old ]]; then
    echo "$2 hasn't changed, skipping..."
  else
    [ -f "$2.bak" ] && \
      "$2.bak would be overwritten, please move or delete that file to prevent data loss" && exit
    [ -f $2 ] && \
      mv $2 "$2.bak"
    cp $1 "$2"
  fi
}

#xorg configs
ln -sf "$PWD/xinitrc" ~/.xinitrc
ln -sf "$PWD/xsession" ~/.xsession
rm ~/.xres
ln -s "$PWD/xres" ~/.xres

# urxvt conf
mkdir -p ~/.urxvt
rm ~/.urxvt/ext
ln -s "$PWD/urxvt-ext" ~/.urxvt/ext

#vim directories and conf
ln -sf "$PWD/vimrc" ~/.vimrc
mkdir -p ~/.vim
mkdir -p ~/.vim/blugin
mkdir -p ~/.vim/autoload
mkdir -p ~/.vim/files
mkdir -p ~/.vim/files/swap
mkdir -p ~/.vim/files/backup
mkdir -p ~/.vim/files/info
mkdir -p ~/.vim/files/undo
ln -sf "$PWD/plug.vim" ~/.vim/autoload/plug.vim

#gpg config
#[ -f ~/.gnupg/gpg.conf.bak ] && rm ~/.gnupg/gpg.conf.bak
#[ -f ~/.gnupg/gpg-agent.conf.bak ] && rm ~/.gnupg/gpg-agent.conf.bak
#[ -f ~/.gnupg/gpg.conf ] && mv ~/.gnupg/gpg.conf ~/.gnupg/gpg.conf.bak
#[ -f ~/.gnupg/gpg-agent.conf ] && 

mkdir -p ~/.gnupg
safe_copy "$PWD/gpg/gpg.conf" ~/.gnupg/gpg.conf
safe_copy "$PWD/gpg/gpg-agent.conf" ~/.gnupg/gpg-agent.conf
mkdir -p ~/.ssh
safe_copy "$PWD/ssh_config" ~/.ssh/config
#cp "$PWD/gpg/gpg.conf" ~/.gnupg/gpg.conf
#cp "$PWD/gpg/gpg-agent.conf" ~/.gnupg/gpg-agent.conf

#tmux config
ln -sf "$PWD/tmux.conf" ~/.tmux.conf

#zsh configs
ln -sf "$PWD/antigen.zsh" ~/antigen.zsh
rm -rf ~/.antigen
ln -sf $PWD/zshrc ~/.zshrc
rm ~/.zfunctions
ln -s $PWD/zfunctions ~/.zfunctions

# qutebrowser config
rm ~/.config/qutebrowser
ln -s "$PWD/qutebrowser" ~/.config/qutebrowser

# i3 config
mkdir -p ~/.config/i3
ln -sf "$PWD/i3_config" ~/.config/i3/config

# ranger config
mkdir -p ~/.config/ranger
ln -sf "$PWD/rifle.conf" ~/.config/ranger/rifle.conf
ln -sf "$PWD/rc.conf" ~/.config/ranger/rc.conf

# various configs
ln -sf "$PWD/spacemacs" ~/.spacemacs
ln -sf "$PWD/batrc" ~/.batrc
ln -sf "$PWD/alias" ~/.alias
ln -sf "$PWD/profile" ~/.profile
ln -sf "$PWD/tmux.conf" ~/.tmux.conf
ln -sf "$PWD/compton.conf" ~/.config/compton.conf
ln -sf "$PWD/editorconfig" ~/.editorconfig

# various directories
rm ~/.bin || echo '~/.bin should be a symlink, if it is a directory, please migrate the old files to local or remove it'
ln -s "$PWD/bin" ~/.bin

mkdir -p ~/.local/bin
